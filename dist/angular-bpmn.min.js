"use strict";angular.module("angular-bpmn",[]),angular.module("angular-bpmn").run(["$rootScope",function(t){return function(t){return t.runMode="debug"}}(this)]),angular.module("angular-bpmn").service("log",["$log","$rootScope",function(t,e){return{debug:function(){return"debug"===e.runMode?t.debug.apply(self,arguments):void 0},error:function(){return t.error.apply(self,arguments)}}}]),angular.module("angular-bpmn").factory("bpmnMinimap",["log","$compile","$rootScope",function(t,e,n){var i;return i=function(){function i(e){t.debug("minimap"),this.container=e,this.scope=n.$new(),this.init()}return i.prototype.container=null,i.prototype.scope=null,i.prototype.navigator=null,i.prototype.canvasSupported=null,i.prototype.forceDom=!1,i.prototype.$canvas=null,i.prototype.$viewport=null,i.prototype.ctx=null,i.prototype.$elem=null,i.prototype.init=function(){var t;return t=e('<div class="mgNavigator"><canvas></canvas><div class="mgViewport"></div></div>')(this.scope),this.container.append(t),this.$navigator=$(this.container).find(".mgNavigator"),this.$canvas=this.$navigator.find("canvas"),this.$elem=$(this.container).find(".scheme"),this.ratio=.1,this.checkCanvas(),this.ctx=this.$canvas.get(0).getContext("2d"),this.$viewport=this.$navigator.find(".mgViewport"),this.bindings(),this.updateViewport(),this.renderScheme()},i.prototype.checkCanvas=function(){var t;return t=this.$canvas.get(0),this.canvasSupported=!(!t.getContext||!t.getContext("2d")),this.canvasSupported},i.prototype.updateViewport=function(){var e,n,i,o;return t.debug("update viewport"),e=this.$elem.height(),n=this.$elem.width(),o=this.$elem.scrollTop(),i=this.$elem.scrollLeft(),this.$viewport.css({left:i*this.ratio,top:o*this.ratio}).width(n*this.ratio).height(e*this.ratio)},i.prototype.scrolled=function(t){return this.$elem.offset({left:-t.left/this.ratio,top:-t.top/this.ratio})},i.prototype.bindings=function(){return this.scrolling=!1,this.$navigator.click(function(t){return function(e){var n,i,o,s;return s=e.pageX-$(e.target).offset().left-t.$viewport.width()/2,o=e.pageY-$(e.target).offset().top-t.$viewport.height()/2,n=t.$navigator.width()-t.$viewport.width(),i=t.$navigator.height()-t.$viewport.height(),0>s&&(s=0),s>n&&(s=n),0>o&&(o=0),o>i&&(o=i),t.$viewport.css({left:s,top:o}),t.scrolled(t.$viewport.position())}}(this)),this.$viewport.draggable({containment:"parent",start:function(t){return function(e,n){return t.scrolling=!0}}(this),drag:function(t){return function(e,n){return t.scrolled(n.position)}}(this),stop:function(t){return function(e,n){return t.scrolling=!1,t.scrolled(n.position)}}(this)}),this.$elem.scroll(function(){return t.debug("element scrolling")})},i.prototype.renderScheme=function(){var e;return this.ctx.clearRect(0,0,this.ctx.width,this.ctx.height),this.$navigator.hide(),e=this.$elem.find(".draggable svg, svg.jsplumb-connector"),t.debug(e),e.each(function(){var t,e;return t=document.createElement("canvas"),t.setAttribute("class","screenShotTempCanvas"),t.style.position="absolute",t.style.left=this.style.left,t.style.top=this.style.top,e=(new XMLSerializer).serializeToString(this),canvg(t,e),$(t).insertAfter(this),this.setAttribute("class","tempHide"),$(this).hide()}),html2canvas(this.$elem,{allowTaint:!0,onrendered:function(e){return function(n){var i;return i=e.$canvas.get(0),e.ctx.drawImage(n,0,0,n.width,n.height,0,0,i.width,i.height),e.$navigator.show(),e.updating=!1,t.debug("Html2Canvas end drawing")}}(this)})},i.prototype.destroy=function(){},i}()}]),angular.module("angular-bpmn").service("bpmnMock",function(){return{scheme1:{name:"Simply bpmn scheme",description:"",objects:[{id:1,type:{name:"event",start:{0:{0:!0}}},position:{top:80,left:50},status:"",error:"",title:"start event",description:""},{id:2,type:{name:"task",status:"",action:""},position:{top:60,left:260},status:"",error:"",title:"task",description:""},{id:3,type:{name:"event",end:{simply:{top_level:!0}}},position:{top:80,left:530},status:"",error:"",title:"end event",description:""}],connectors:[{id:1,start:{object:1,point:1},end:{object:2,point:10},flow_type:"default",title:"connector №1"},{id:2,start:{object:2,point:4},end:{object:3,point:3},flow_type:"default",title:"connector №2"}]},scheme2:{name:"Parallel Event-Based Gateway",description:"",objects:[{id:1,type:{name:"event",start:{0:{0:!0}}},position:{top:80,left:50},status:"",error:"",title:"message 1",description:""},{id:2,type:{name:"event",start:{0:{0:!0}}},position:{top:240,left:50},status:"",error:"",title:"message 2",description:""},{id:3,type:{name:"gateway",base:"data",status:"xor"},position:{top:160,left:190},status:"",error:"",title:"",description:""},{id:4,type:{name:"task"},position:{top:140,left:370},status:"",error:"",title:"task",description:""}],connectors:[{id:1,start:{object:1,point:1},end:{object:3,point:0},flow_type:"default",title:"connector №1"},{id:2,start:{object:2,point:1},end:{object:3,point:2},flow_type:"default",title:"connector №2"},{id:2,start:{object:3,point:1},end:{object:4,point:10},flow_type:"default",title:"connector №3"}]},scheme3:{name:"Base scheme",description:"",objects:[{id:1,type:{name:"event",start:{simply:{top_level:!0}}},parent:0,position:{top:210,left:120},status:"",error:"",title:"",description:""},{id:2,type:{name:"task"},parent:0,position:{top:190,left:220},status:"",error:"",title:"Оформить заявку",description:""},{id:3,type:{name:"task"},parent:0,position:{top:190,left:370},status:"",error:"",title:"Рассмотреть заявку",description:""},{id:4,type:{name:"gateway"},parent:0,position:{top:210,left:540},status:"",error:"",title:"Одобрена?",description:""},{id:5,type:{name:"task"},parent:0,position:{top:190,left:650},status:"",error:"",title:"Выделить машину",description:""},{id:6,type:{name:"task"},parent:0,position:{top:390,left:510},status:"",error:"",title:"Заявка отклоннена",description:""},{id:7,type:{name:"event",end:{simply:{top_level:!0}}},parent:0,position:{top:550,left:540},status:"",error:"",title:"Заявка отклонена",description:""},{id:8,type:{name:"gateway"},parent:0,position:{top:210,left:810},status:"",error:"",title:"Выделена?",description:""},{id:9,type:{name:"gateway",status:"parallel"},parent:0,position:{top:210,left:930},status:"",error:"",title:"",description:""},{id:10,type:{name:"task"},parent:0,position:{top:100,left:1050},status:"",error:"",title:"Машина выделена",description:""},{id:11,type:{name:"task"},parent:0,position:{top:290,left:1050},status:"",error:"",title:"Выполнить рейс",description:""},{id:12,type:{name:"gateway",status:"parallel"},parent:0,position:{top:210,left:1200},status:"",error:"",title:"",description:""},{id:13,type:{name:"event",end:{simply:{top_level:!0}}},parent:0,position:{top:210,left:1340},status:"",error:"",title:"Заявка выполнена",description:""}],connectors:[{id:1,start:{object:1,point:1},end:{object:2,point:10},flow_type:"default",title:""},{id:2,start:{object:2,point:4},end:{object:3,point:10},flow_type:"default",title:""},{id:3,start:{object:3,point:4},end:{object:4,point:3},flow_type:"default",title:""},{id:4,start:{object:4,point:2},end:{object:6,point:1},flow_type:"default",title:"Нет"},{id:4,start:{object:4,point:1},end:{object:5,point:10},flow_type:"default",title:"Да"},{id:5,start:{object:6,point:7},end:{object:7,point:0},flow_type:"default",title:""},{id:6,start:{object:5,point:4},end:{object:8,point:3},flow_type:"default",title:""},{id:7,start:{object:8,point:0},end:{object:3,point:1},flow_type:"default",title:"Нет"},{id:8,start:{object:8,point:1},end:{object:9,point:3},flow_type:"default",title:"Да"},{id:9,start:{object:9,point:1},end:{object:10,point:10},flow_type:"default",title:""},{id:10,start:{object:9,point:1},end:{object:11,point:10},flow_type:"default",title:""},{id:11,start:{object:10,point:4},end:{object:12,point:0},flow_type:"default",title:""},{id:12,start:{object:11,point:4},end:{object:12,point:2},flow_type:"default",title:""},{id:13,start:{object:12,point:1},end:{object:13,point:3},flow_type:"default",title:""}]},scheme4:{name:"Base scheme with grouping",description:"",objects:[{id:1,type:{name:"event",start:{simply:{top_level:!0}}},position:{top:80,left:50},status:"",error:"",title:"",description:""},{id:2,type:{name:"task"},parent:14,position:{top:40,left:40},status:"",error:"",title:"Оформить заявку",description:""},{id:3,type:{name:"task"},parent:15,position:{top:40,left:40},status:"",error:"",title:"Рассмотреть заявку",description:""},{id:4,type:{name:"gateway"},position:{top:290,left:370},status:"",error:"",title:"Одобрена?",description:""},{id:5,type:{name:"task"},parent:14,position:{top:40,left:200},status:"",error:"",title:"Заявка отклонена",description:""},{id:6,type:{name:"event",end:{simply:{top_level:!0}}},parent:14,position:{top:60,left:380},status:"",error:"",title:"Заявка отклонена",description:""},{id:7,type:{name:"task"},parent:16,position:{top:30,left:30},status:"",error:"",title:"Выделить машину",description:""},{id:8,type:{name:"gateway"},parent:16,position:{top:50,left:210},status:"",error:"",title:"Выделена?",description:""},{id:9,type:{name:"gateway",status:"parallel"},parent:16,position:{top:50,left:340},status:"",error:"",title:"",description:""},{id:10,type:{name:"task"},parent:14,position:{top:40,left:480},status:"",error:"",title:"Машина выделена",description:""},{id:11,type:{name:"gateway",status:"parallel"},position:{top:80,left:780},status:"",error:"",title:"",description:""},{id:12,type:{name:"event",end:{simply:{top_level:!0}}},position:{top:80,left:890},status:"",error:"",title:"Заявка выполнена",description:""},{id:13,type:{name:"task"},parent:16,position:{top:30,left:440},status:"",error:"",title:"Выполнить рейс",description:""},{id:14,type:{name:"group"},position:{top:20,left:140},width:"614px",height:"170px",status:"",error:"",title:"Заказчик",description:"",style:"solid"},{id:15,type:{name:"group"},position:{top:230,left:140},width:"186px",height:"176px",status:"",error:"",title:"Канцелярия",description:"",style:"solid"},{id:16,type:{name:"group"},position:{top:430,left:310},width:"588px",height:"168px",status:"",error:"",title:"Гараж",description:"",style:"solid"}],connectors:[{id:1,start:{object:1,point:1},end:{object:2,point:10},flow_type:"default",title:""},{id:2,start:{object:2,point:7},end:{object:3,point:1},flow_type:"default",title:""},{id:3,start:{object:3,point:4},end:{object:4,point:3},flow_type:"default",title:""},{id:4,start:{object:4,point:0},end:{object:5,point:7},flow_type:"default",title:"нет"},{id:5,start:{object:5,point:4},end:{object:6,point:3},flow_type:"default",title:""},{id:6,start:{object:4,point:2},end:{object:7,point:1},flow_type:"default",title:"да"},{id:7,start:{object:7,point:4},end:{object:8,point:3},flow_type:"default",title:""},{id:7,start:{object:8,point:2},end:{object:3,point:7},flow_type:"default",title:"нет"},{id:8,start:{object:8,point:1},end:{object:9,point:3},flow_type:"default",title:"да"},{id:9,start:{object:9,point:0},end:{object:10,point:7},flow_type:"default",title:""},{id:10,start:{object:10,point:4},end:{object:11,point:3},flow_type:"default",title:""},{id:11,start:{object:11,point:1},end:{object:12,point:3},flow_type:"default",title:""},{id:12,start:{object:13,point:1},end:{object:11,point:2},flow_type:"default",title:""},{id:13,start:{object:9,point:1},end:{object:13,point:10},flow_type:"default",title:""}]},scheme5:{name:"Base scheme with swimlane",description:"",objects:[{id:1,type:{name:"event",start:{simply:{top_level:!0}}},parent:15,position:{top:70,left:120},status:"",error:"",title:"",description:""},{id:2,type:{name:"task"},parent:15,position:{top:50,left:240},status:"",error:"",title:"Оформить заявку",description:""},{id:3,type:{name:"task"},parent:16,position:{top:60,left:240},status:"",error:"",title:"Рассмотреть заявку",description:""},{id:4,type:{name:"gateway"},parent:16,position:{top:80,left:420},status:"",error:"",title:"Одобрена?",description:""},{id:5,type:{name:"task"},parent:15,position:{top:50,left:390},status:"",error:"",title:"Заявка отклонена",description:""},{id:6,type:{name:"event",end:{simply:{top_level:!0}}},parent:15,position:{top:70,left:570},status:"",error:"",title:"Заявка отклонена",description:""},{id:7,type:{name:"task"},parent:17,position:{top:60,left:390},status:"",error:"",title:"Выделить машину",description:""},{id:8,type:{name:"gateway"},parent:17,position:{top:80,left:570},status:"",error:"",title:"Выделена?",description:""},{id:9,type:{name:"gateway",status:"parallel"},parent:17,position:{top:80,left:690},status:"",error:"",title:"",description:""},{id:10,type:{name:"task"},parent:15,position:{top:50,left:660},status:"",error:"",title:"Машина выделена",description:""},{id:11,type:{name:"gateway",status:"parallel"},parent:15,position:{top:70,left:830},status:"",error:"",title:"",description:""},{id:12,type:{name:"event",end:{simply:{top_level:!0}}},parent:15,position:{top:70,left:940},status:"",error:"",title:"Заявка выполнена",description:""},{id:13,type:{name:"task"},parent:17,position:{top:60,left:800},status:"",error:"",title:"Выполнить рейс",description:""},{id:14,type:{name:"swimlane"},position:{top:10,left:10},width:"1040px",height:"",status:"",error:"",title:"",description:"",style:""},{id:15,type:{name:"swimlane-row"},parent:14,position:{top:0,left:0},width:"100%",height:"200px",status:"",error:"",title:"Заказчик",description:"",style:""},{id:16,type:{name:"swimlane-row"},parent:14,position:{top:0,left:0},width:"100%",height:"200px",status:"",error:"",title:"Канцелярия",description:"",style:""},{id:17,type:{name:"swimlane-row"},parent:14,position:{top:0,left:0},width:"100%",height:"200px",status:"",error:"",title:"Гараж",description:"",style:""}],connectors:[{id:1,start:{object:1,point:1},end:{object:2,point:10},flow_type:"default",title:""},{id:2,start:{object:2,point:7},end:{object:3,point:1},flow_type:"default",title:""},{id:3,start:{object:3,point:4},end:{object:4,point:3},flow_type:"default",title:""},{id:4,start:{object:4,point:0},end:{object:5,point:7},flow_type:"default",title:"нет"},{id:5,start:{object:5,point:4},end:{object:6,point:3},flow_type:"default",title:""},{id:6,start:{object:4,point:2},end:{object:7,point:1},flow_type:"default",title:"да"},{id:7,start:{object:7,point:4},end:{object:8,point:3},flow_type:"default",title:""},{id:7,start:{object:8,point:2},end:{object:3,point:7},flow_type:"default",title:"нет"},{id:8,start:{object:8,point:1},end:{object:9,point:3},flow_type:"default",title:"да"},{id:9,start:{object:9,point:0},end:{object:10,point:7},flow_type:"default",title:""},{id:10,start:{object:10,point:4},end:{object:11,point:3},flow_type:"default",title:""},{id:11,start:{object:11,point:1},end:{object:12,point:3},flow_type:"default",title:""},{id:12,start:{object:13,point:1},end:{object:11,point:2},flow_type:"default",title:""},{id:13,start:{object:9,point:1},end:{object:13,point:10},flow_type:"default",title:""}]}}}),angular.module("angular-bpmn").directive("bpmnObject",["log","$timeout","$templateCache","$compile","$templateRequest","$q",function(t,e,n,i,o,s){return{restrict:"A",controller:["$scope","$element",function(t,e){var n,i,o;switch(i=$(e),n=[],t.data.type.name){case"poster":i.find("img").on("dragstart",function(t){return t.preventDefault()});break;case"group":i.resizable({minHeight:100,minWidth:100,grid:10,handles:"all",start:function(e,i){return n=t.object.getAllChilds()},stop:function(e,n){return t.instance.repaintEverything()},resize:function(e,o){return angular.forEach(n,function(t,e){var n,o;return n=t.position.left+t.size.width,o=t.position.top+t.size.height,i.width()<=n+20&&i.css("width",n+20),i.height()<=o+20?i.css("height",o+20):void 0}),t.instance.repaintEverything()}});break;case"swimlane":i.resizable({minHeight:200,minWidth:400,grid:10,handles:"e",start:function(){return n=t.object.getAllChilds(),t.instance.repaintEverything()},resize:function(){return angular.forEach(n,function(t){var e;if("swimlane-row"!==t.data.type)return e=t.position.left+t.size.width,i.width()<=e+20?i.css("width",e+20):void 0}),t.instance.repaintEverything()}});break;case"swimlane-row":i.resizable({minHeight:200,minWidth:400,grid:10,handles:"s",start:function(){return n=t.object.getAllChilds(),t.instance.repaintEverything()},resize:function(){return angular.forEach(n,function(t){var e;return e=t.position.top+t.size.height,i.height()<=e+20?i.css("height",e+20):void 0}),t.instance.repaintEverything()}})}return o=function(){var e;return e={top:t.data.position.top,left:t.data.position.left},i.css(e),t.instance.repaintEverything()},t.$watch("data.position",function(t,e){return t!==e?o():void 0}),o()}],link:function(t,e,n){}}}]),angular.module("angular-bpmn").factory("bpmnObjectFact",["bpmnSettings","$compile","$rootScope","log","$templateRequest","$templateCache",function(t,e,n,i,o,s){var r;return r=function(){function r(e,n){var o;i.debug("object construct"),this.parentScope=n,this.settings=n.settings,this.data=e,o=t.template(e.type.name),this.anchor=o.anchor,this.size=o.size,this.make=o.make,this.draggable=o.draggable,this.templateUrl=o.templateUrl||null,this.template=o.template||null,this.childs=[],this.position={top:e.position.top,left:e.position.left},this.templateUpdate()}return r.prototype.id=null,r.prototype.isDebug=!0,r.prototype.parentScope=null,r.prototype.data=null,r.prototype.anchor=null,r.prototype.make=null,r.prototype.draggable=null,r.prototype.templateUrl=null,r.prototype.template=null,r.prototype.element=null,r.prototype.container=null,r.prototype.size=null,r.prototype.points=null,r.prototype.settings=null,r.prototype.childs=null,r.prototype.position={top:0,left:0},r.prototype.isParent=!1,r.prototype.templateUpdate=function(){var t,r,a,p;return r=n.$new(),r.data=this.data,r.instance=this.parentScope.instance,r.object=this,t=function(t){return function(e){return t.element.empty().append(e)}}(this),null!=this.templateUrl&&""!==this.templateUrl?(null==this.element&&(this.element=e('<div bpmn-object class="'+this.data.type.name+' draggable etc" ng-class="[data.status]"></div>')(r)),p=this.settings.theme.root_path+"/"+this.settings.engine.theme+"/"+this.templateUrl,a=s.get(p),null==a?(i.debug("template not found",p),this.elementPromise=o(p),this.elementPromise.then(function(n){return t(e(n)(r)),s.put(p,n)})):t(e(a)(r))):null==this.element?this.element=e(this.template)(r):void 0},r.prototype.generateAnchor=function(t){var e;if(this.anchor&&0!==this.anchor.length)return this.element?(e=[],angular.forEach(this.anchor,function(n){return function(i){var o;return o=n.parentScope.instance.addEndpoint(n.element,{anchor:i,maxConnections:-1},t),-1===e.indexOf(o)?e.push(o):void 0}}(this)),this.points=e):void i.debug("generateAnchor: @element is null",this)},r.prototype.appendTo=function(t,e){return this.element&&""!==this.element?(this.container=t,t.append(this.element),this.size?$(this.element).css({width:this.size.width,height:this.size.height}):i.error("@size is null, element:",this.element),this.checkParent(),this.generateAnchor(e),this.setDraggable(this.draggable)):void i.debug("appendTo: @element is null",this)},r.prototype.select=function(t){return t?$(this.element).addClass("selected"):$(this.element).removeClass("selected")},r.prototype.getId=function(){return null==this.id&&(this.id=$(this.element).attr("id")),this.id},r.prototype.setDraggable=function(t){return this.parentScope.instance.setDraggable($(this.element),t)},r.prototype.group=function(t){return this.parentScope.instance.addToPosse(this.getId(),{id:t,active:!0})},r.prototype.ungroup=function(t){return this.parentScope.instance.removeFromPosse(this.getId(),t)},r.prototype.checkParent=function(){var t,e;if(null!=this.data.parent&&""!==this.data.parent&&(t=null,angular.forEach(this.parentScope.intScheme.objects,function(e){return function(n){return n.data.id===e.data.parent?t=n:void 0}}(this)),null!=t))return this.element.removeClass("etc"),e=this.setParent(t),null!=this.data.draggable&&this.data.draggable||null==this.data.draggable?this.parentScope.instance.draggable(this.element,$.extend({},this.settings.draggable,{containment:e,drag:function(t,e){},stop:function(t,e){return this.position.left=t.pos[0],this.position.top=t.pos[1],this.parentScope.instance.repaintEverything()}})):void 0},r.prototype.setParent=function(t){var e,n;if(null!=t)return n=t.element,this.parentScope.instance.setParent(this.element,n),e=n.attr("id"),t.isParent=!0,-1===$.inArray(this.data,t.childs)&&t.childs.push(this),n.hasClass(e)?e:(n.addClass(e).removeClass("etc"),null!=t.data.draggable&&t.data.draggable||null==t.data.draggable?this.parentScope.instance.draggable(n,$.extend({},this.settings.draggable,{drag:function(t){return function(e,n){return t.parentScope.instance.repaintEverything()}}(this),stop:function(t){return function(e,n){return t.position.left=e.pos[0],t.position.top=e.pos[1],t.parentScope.instance.repaintEverything()}}(this)})):void 0)},r.prototype.removeParent=function(){},r.prototype.getAllChilds=function(){var t;return t=[],angular.forEach(this.childs,function(e){var n;return t.push(e),n=e.getAllChilds(),n.length>0?t=t.concat(n):void 0}),t},r.prototype.remove=function(){var t;return t=this.getId(),null!=t?(i.debug("remove: ",t),this.parentScope.instance.detachAllConnections(this.element).empty(t).remove(t),this.childs=null,this.isParent=!1,this.container=null,this.element=null,this.points=null):void 0},r}()}]);var LEFT_MB,MIDDLE_MB,RIGHT_MB;LEFT_MB=1,MIDDLE_MB=2,RIGHT_MB=3,angular.module("angular-bpmn").factory("bpmnScheme",["$rootScope","log","bpmnUuid","$compile","bpmnSettings","$templateCache","$templateRequest","$q","$timeout","bpmnObjectFact","bpmnMinimap",function(t,e,n,i,o,s,r,a,p,l,c){var d;return d=function(){function d(e,i){var o;this.id=n.gen(),this.container=e,o=e.parent("."+this.wrap_class),0===o.length&&e.wrap('<div class="'+this.wrap_class+'"></div>'),this.wrapper=e.parent("."+this.wrap_class),preventSelection(document),this.scope=t.$new(),this.scope.extScheme={},this.scope.intScheme={objects:{},connectors:[]},this.scope.settings={},this.scope.selected=[],this.scope.zoom=1,this.setSettings(i),this.wrapper.append('<div class="page-loader"><div class="spinner">loading...</div></div>')}return d.prototype.isDebug=!0,d.prototype.isStarted=!1,d.prototype.id=null,d.prototype.scope=null,d.prototype.container=null,d.prototype.wrapper=null,d.prototype.cache=null,d.prototype.style_id="bpmn-style-theme",d.prototype.wrap_class="bpmn-wrapper",d.prototype.schemeWatch=null,d.prototype.stopListen=null,d.prototype.minimap=null,d.prototype.setStatus=function(){return"editor"===this.scope.settings.engine.status?this.container.addClass("editor"):this.container.addClass("viewer")},d.prototype.setScheme=function(t){return null==t&&(t=this.scope.extScheme||{}),this.scope.extScheme=t},d.prototype.setSettings=function(t){return null==t&&(t={}),this.scope.settings=$.extend(!0,o,angular.copy(t)),this.loadStyle(),this.cacheTemplates(),this.objectsUpdate()},d.prototype.loadStyle=function(){var t,n,i;return i=this.scope.settings.engine.theme,t=this.scope.settings.theme.root_path+"/"+i+"/style.css",n=$("link#"+this.style_id+"-"+i),0===n.length?$("<link/>",{rel:"stylesheet",href:t,id:this.style_id+"-"+i}).appendTo("head"):n.attr("href",t),e.debug("load style file:",t),this.wrapper.removeClass(),this.wrapper.addClass(this.wrap_class+" "+i)},d.prototype.cacheTemplates=function(){return this.cache||(this.cache=[]),angular.forEach(this.scope.settings.templates,function(t){return function(n){var i,o,a;if(null!=n.templateUrl&&""!==n.templateUrl)return a=t.scope.settings.theme.root_path+"/"+t.scope.settings.engine.theme+"/"+n.templateUrl,i=s.get(a),null==i?(o=r(a),t.cache.push(o),o.then(function(t){return e.debug("load template file:",a),s.put(a,t)})):void 0}}(this))},d.prototype.makePackageObjects=function(t){var e;return e=[],angular.forEach(this.scope.extScheme.objects,function(t){return function(n){var i;return i=new l(n,t.scope),t.scope.intScheme.objects[n.id]=i,e.push(i.elementPromise)}}(this)),a.all(e).then(function(e){return function(){return angular.forEach(e.scope.intScheme.objects,function(t){return t.appendTo(e.container,e.scope.settings.point),e.scope.instance.off(t.element),e.scope.instance.on(t.element,"click",function(){return e.scope.selected=[],e.scope.$apply(e.scope.selected.push(t.data.id)),e.deselectAll(),t.select(!0)})}),e.instanceBatch(),e.connectPackageObjects(),e.isStarted=!0,e.wrapper.find(".page-loader").fadeOut("slow"),e.minimap||(e.minimap=new c(e.wrapper)),t()}}(this))},d.prototype.instanceBatch=function(){return this.scope.instance.batch(function(t){return function(){return e.debug("instance batch"),"editor"===t.scope.settings.engine.status?t.scope.instance.draggable(t.container.find(".etc"),t.scope.settings.draggable):void 0}}(this))},d.prototype.connectPackageObjects=function(){var t;if(null!=(null!=(t=this.scope.extScheme)?t.connectors:void 0))return e.debug("connect package objects"),angular.forEach(this.scope.extScheme.connectors,function(t){return function(n){var i,o,s;if(n.start&&n.end&&t.scope.intScheme.objects[n.start.object]&&t.scope.intScheme.objects[n.end.object]&&t.scope.intScheme.objects[n.start.object].points&&t.scope.intScheme.objects[n.end.object].points)return o={},s={},angular.forEach(t.scope.intScheme.objects,function(t){return t.data.id===n.start.object&&(o=t.points),t.data.id===n.end.object?s=t.points:void 0}),null==o[n.start.point]?void e.error("connect: source not found",t):null==s[n.end.point]?void e.error("connect: target not found",t):(i={sourceEndpoint:o[n.start.point],targetEndpoint:s[n.end.point]},n.title&&""!==n.title&&(i.overlays=[["Label",{label:n.title,cssClass:"aLabel"},{id:"myLabel"}]]),t.scope.intScheme.connectors.push(t.scope.instance.connect(i,t.scope.settings.connector)))}}(this))},d.prototype.addObject=function(t){},d.prototype.removeObject=function(t){},d.prototype.deselectAll=function(){return angular.forEach(this.scope.intScheme.objects,function(t){return t.select(!1)})},d.prototype.panning=function(){var t,e,n;return n=i('<div class="panning-cross"> <svg> <g id="layer1" transform="translate(-291.18256,-337.29837)"> <path id="path3006" stroke-linejoin="miter" d="m331.14063,340.36763,0,29.99702" stroke="#000" stroke-linecap="butt" stroke-miterlimit="4" stroke-dasharray="none" stroke-width="2.01302433"/> <path id="path3008" stroke-linejoin="miter" d="m316.11461,355.29379,30.24144,0" stroke="#000" stroke-linecap="butt" stroke-miterlimit="4" stroke-dasharray="none" stroke-width="2"/> </g> </svg> </div>')(this.scope),this.container.append(n),$(n).css({position:"absolute",top:-23,left:-45}),this.wrapper.append(i('<div class="zoom-info">x{{zoom}}</div>')(this.scope)),e={x:0,y:0,state:!1},t={x:0,y:0},this.wrapper.on("mousedown",function(t){return function(n){return t.scope.settings.engine.container.movable&&!$(n.target).hasClass("ui-resizable-handle")?e.state||n.which!==LEFT_MB?void 0:(e.x=n.pageX,e.y=n.pageY,e.state=!0):void 0}}(this)),this.wrapper.on("mousemove",function(n){return function(i){var o;return e.state?(t.x=i.pageX-e.x,t.y=i.pageY-e.y,o=n.container.offset(),n.container.offset({left:o.left+t.x,top:o.top+t.y}),e.x=i.pageX,e.y=i.pageY):void 0}}(this)),this.wrapper.on("mouseup",function(t){return function(n){return t.scope.settings.engine.container.movable&&e.state?e.state=!1:void 0}}(this)),this.wrapper.on("contextmenu",function(t){return!1}),this.wrapper.on("mouseleave",function(t){return e.state?e.state=!1:void 0}),this.wrapper.on("mousewheel",function(t){return function(e){return t.scope.settings.engine.container.zoom?(e.preventDefault(),t.scope.zoom+=.1*e.deltaY,t.scope.zoom=parseFloat(t.scope.zoom.toFixed(1)),t.scope.zoom<.1?t.scope.zoom=.1:t.scope.zoom>2&&(t.scope.zoom=2),t.scope.instance.setZoom(t.scope.zoom),t.scope.instance.repaintEverything(t.scope.zoom),p(function(){return t.scope.$apply(t.scope.zoom)},0),t.container.css({"-webkit-transform":t.scope.zoom,"-moz-transform":"scale("+t.scope.zoom+")","-ms-transform":"scale("+t.scope.zoom+")","-o-transform":"scale("+t.scope.zoom+")",transform:"scale("+t.scope.zoom+")"})):void 0}}(this))},d.prototype.objectsUpdate=function(){return angular.forEach(this.scope.intScheme.objects,function(t){return t.templateUpdate()})},d.prototype.start=function(){return e.debug("start"),a(function(t){return function(e){return t.instart(e)}}(this))},d.prototype.instart=function(t){var e;return this.panning(),this.loadStyle(),this.scope.instance||(this.scope.instance=jsPlumb.getInstance($.extend(!0,this.scope.settings.instance,{Container:this.container}))),this.cache=[],this.cacheTemplates(),this.container.addClass("bpmn"),this.setStatus(),this.schemeWatch&&this.schemeWatch(),this.schemeWatch=this.scope.$watch("extScheme",function(t){return function(e,n){return e!==n?t.restart():void 0}}(this)),a.all(this.cache).then(function(e){return function(){return e.makePackageObjects(t)}}(this)),null!=(null!=(e=this.scope.settings.engine.container)?e.resizable:void 0)&&(this.wrapper.resizable("instance")&&this.wrapper.resizable("destroy"),this.wrapper.resizable({minHeight:200,minWidth:400,grid:10,handles:"s"})),this.stopListen=this.scope.$on("$routeChangeSuccess",function(t){return function(){return t.destroy()}}(this))},d.prototype.destroy=function(){return e.debug("destroy"),this.wrapper.find(".page-loader").fadeIn("fast"),angular.forEach(this.scope.intScheme.objects,function(t){return t.remove()}),this.scope.intScheme.objects=[],this.scope.instance.empty(this.container),this.schemeWatch&&this.schemeWatch(),this.wrapper.off("mousedown"),this.wrapper.off("mousemove"),this.wrapper.off("mouseup"),this.wrapper.off("contextmenu"),this.wrapper.off("mousewheel"),this.minimap&&this.minimap.destroy(),this.minimap=null},d.prototype.restart=function(){return e.debug("restart"),null!=this.isStarted&&this.destroy(),this.start()},d}()}]),angular.module("angular-bpmn").factory("bpmnSettings",function(){var t,e,n,i,o,s,r,a,p,l,c,d;return d={root_path:"/themes",list:["orange","minimal"]},o={theme:"minimal",status:"viewer",container:{resizable:!0,zoom:!0,movable:!1,minimap:!1}},s={DragOptions:{cursor:"pointer",zIndex:20},ConnectionOverlays:[["Arrow",{location:1,id:"arrow",width:12,length:12,foldback:.8}]],Container:"container"},i={filter:".ui-resizable-handle",grid:[5,5],drag:function(t,e){}},n={strokeStyle:"#000000",lineWidth:2,outlineWidth:4},r={isSource:!0,isTarget:!0,endpoint:["Dot",{radius:1}],maxConnections:-1,paintStyle:{outlineWidth:1},hoverPaintStyle:{},connectorStyle:n},t=["Flowchart",{cornerRadius:0,midpoint:.5,minStubLength:10,stub:[30,30],gap:0}],e={connector:t,isSource:!0,isTarget:!0},a={filter:".ep",anchor:[],connector:t,connectorStyle:n,endpoint:["Dot",{radius:1}],maxConnections:-1,onMaxConnections:function(t,e){return alert("Maximum connections ("+t.maxConnections+") reached")}},p={anchor:[],endpoint:["Dot",{radius:1}],allowLoopback:!1,uniqueEndpoint:!0,isTarget:!0,maxConnections:-1},c={event:{templateUrl:"event.svg",anchor:[[.52,.05,0,-1,0,2],[1,.52,1,0,-2,0],[.52,1,0,1,0,-2],[.1,.52,-1,0,2,0]],make:["source","target"],draggable:!0,size:{width:50,height:50}},task:{templateUrl:"task.svg",anchor:[[.25,.04,0,-1,0,2],[.5,.04,0,-1,0,2],[.75,.04,0,-1,0,2],[.97,.25,1,0,-2,0],[.97,.5,1,0,-2,0],[.97,.75,1,0,-2,0],[.75,.97,0,1,0,-2],[.5,.97,0,1,0,-2],[.25,.97,0,1,0,-2],[.04,.75,-1,0,2,0],[.04,.5,-1,0,2,0],[.04,.25,-1,0,2,0]],make:["source","target"],draggable:!0,size:{width:112,height:92}},gateway:{templateUrl:"gateway.svg",anchor:[[.5,0,0,-1,0,2],[1,.5,1,0,-2,0],[.5,1,0,1,0,-2],[0,.5,-1,0,2,0]],make:["source","target"],draggable:!0,size:{width:52,height:52}},group:{template:'<div bpmn-object class="group etc draggable" ng-style="{width: data.width, height: data.height}" ng-class="{ dashed : data.style == \'dashed\', solid : data.style == \'solid\' }"> <div class="title">{{data.title}}</div> </div>',anchor:[],make:[],draggable:!0,size:{width:"auto",height:"auto"}},swimlane:{template:'<div bpmn-object class="swimlane etc draggable" ng-style="{ width: data.width }"></div>',anchor:[],
make:[],draggable:!0,size:{width:"auto",height:"auto"}},"swimlane-row":{template:'<div bpmn-object class="swimlane-row" ng-style="{width: \'100%\', height: data.height }"> <div class="header"><div class="text">{{data.title}}</div></div> </div>',anchor:[],make:[],draggable:!1,size:{width:"auto",height:"auto"}},poster:{template:'<div bpmn-object class="poster draggable" ng-class="{ \'etc\' : data.draggable }"><img ng-src="{{data.url}}"></div>',anchor:[],make:[],draggable:!0,size:{width:"auto",height:"auto"}},"default":{template:'<div bpmn-object class="dummy etc draggable">shape not found</div>',anchor:[[.5,0,0,-1,0,2],[1,.5,1,0,-2,0],[.5,1,0,1,0,-2],[0,.5,-1,0,2,0]],make:["source","target"],draggable:!0,size:{width:50,height:50}}},l=function(t){return null!=c[t]?c[t]:c["default"]},{theme:d,engine:o,instance:s,draggable:i,point:r,connector:e,source:a,target:p,template:l,templates:c}}),angular.module("angular-bpmn").factory("bpmnUuid",function(){var t;return t=function(){function t(){}return t.generator=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e,n,i;return e=(new Date).getTime(),i=(e+16*Math.random())%16|0,e=Math.floor(e/16),n=null,n="x"===t?i:3&i|8,n.toString(16)})},t.gen=function(){return this.generator()},t}()});