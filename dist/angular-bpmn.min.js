"use strict";angular.module("angular-bpmn",[]),angular.module("angular-bpmn").run(["$rootScope",function(t){return function(t){return t.runMode="debug"}}(this)]);var bind=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("angular-bpmn").factory("bpmnEditor",["log","bpmnUuid","$compile","bpmnObjectFact","$q",function(t,e,n,o,i){var s;return s=function(){function s(t,e){this.removeObject=bind(this.removeObject,this)}return s.prototype.wrapper=null,s.prototype.container=null,s.prototype.scope=null,s.prototype.pallet=null,s.prototype.mouseover=null,s.prototype.initEditor=function(){return this.pallet||(this.wrapper.append(n('<div class="palette-entries popup" bpmn-editor-palette="settings.editorPallet" settings="settings"></div>')(this.scope)),this.pallet=this.wrapper.find(".palette-entries")),this.droppableInit(),this.keyboardBindings(),this.wrapper.on("mousedown",function(t){return function(){return t.deselectAll()}}(this))},s.prototype.droppableInit=function(){return this.wrapper.droppable({drop:function(n){return function(o,i){var s,r,a,p,l,c,u,d;return p=n.wrapper.offset(),c={left:(i.offset.left-p.left-n.container.position().left)/n.scope.zoom,top:(i.offset.top-p.top-n.container.position().top)/n.scope.zoom},l=n.selectElementByPoint(c.top,c.left)[0],t.debug(l),l&&(c={left:$(l.element).offset().left-c.left,top:$(l.element).offset().top-c.top},t.debug(c)),d=$(i.draggable).attr("entry-type"),s=$(i.draggable).parent().attr("data-group"),d&&""!==d?(r=e.gen(),a=[],"swimlane"===s?(a.push($.extend(!0,angular.copy(n.scope.settings.baseObject),{id:r,type:{name:"swimlane"},draggable:!1,position:c})),a.push($.extend(!0,angular.copy(n.scope.settings.baseObject),{id:e.gen(),parent:r,type:{name:"swimlane-row"},draggable:!1}))):a.push($.extend(!0,angular.copy(n.scope.settings.baseObject),{id:r,type:JSON.parse(d),parent:(null!=l&&null!=(u=l.data)?u.id:void 0)||"",draggable:!0,position:c})),n.addObjects(a)):void 0}}(this)})},s.prototype.addObjects=function(t){var e,n;if(t&&""!==t)return n=[],e={},angular.forEach(t,function(t){return function(i){var s;return s=new o(i,t.scope),t.scope.intScheme.objects[i.id]||(t.scope.intScheme.objects[i.id]=s,e[i.id]=s),n.push(s.elementPromise)}}(this)),i.all(n).then(function(t){return function(){return angular.forEach(e,function(e){return e.appendTo(t.container,t.scope.settings.point)})}}(this))},s.prototype.removeObject=function(t){return t&&t.selected?(angular.forEach(t.selected,function(e){return function(e){var n,o,i,s,r;n=0,s=t.intScheme.objects,r=[];for(o in s){if(i=s[o],i.data.id===e){i.remove(),delete t.intScheme.objects[o];break}r.push(n++)}return r}}(this)),t.selected=[],this.serialise(t)):void 0},s.prototype.keyboardBindings=function(){return this.scope.settings.keyboard?(this.wrapper.on("mouseover",function(t){return function(){return t.mouseover=!0}}(this)),this.wrapper.on("mouseleave",function(t){return function(){return t.mouseover=!1}}(this)),angular.forEach(this.scope.settings.keyboard,function(e){return function(n,o){var i;return t.debug("bind key:",n.name),i=e[n.callback]||window[n.callback],"function"==typeof i?key(o,function(t,n){return e.mouseover?(t.preventDefault(),i.apply(null,[e.scope])):void 0}):void 0}}(this))):void 0},s.prototype.selectElementInAabb=function(t,e,n,o){return this.scope.selected=[],angular.forEach(this.scope.intScheme.objects,function(i){var s;return s=i.elementOffset(),s.top>=t&&s.left>=e&&s.right<e+n&&s.bottom<t+o?(this.scope.selected.push(i.data.id),i.select(!0),i.group("select")):i.select(!1)}),this.scope.$apply()},s.prototype.selectElementOutPoint=function(t,e,n,o){var i,s,r,a,p;this.scope.selected=[],a=this.scope.intScheme.objects,p=[];for(s in a){if(r=a[s],i=r.elementOffset(),i.top<=t&&i.left<=e&&i.right>=e+n&&i.bottom>=t+o){this.scope.selected.push(r.data.id);break}p.push(void 0)}return p},s.prototype.selectElementByPoint=function(e,n){var o,i,s,r,a;this.scope.selected=[],t.debug("check position:",e,n),a=this.scope.intScheme.objects;for(i in a)s=a[i],s.canAParent&&(r=this.wrapper.offset(),o=s.elementOffset(),t.debug("check:",s.data.type.name),o.top-r.top<=e&&o.left-r.left<=n&&o.right-r.left>=n&&o.bottom-r.top>=e?(t.debug("===>",s.data.type.name),t.debug("===>",o.top,o.left,o.right,o.bottom),this.scope.selected.push(s)):t.debug("no:",o.top,o.left,o.right,o.bottom));return this.scope.selected},s.prototype.serialise=function(t){var e;return e=[],angular.forEach(t.intScheme.objects,function(t){return e.push({id:t.data.id,type:t.data.type,position:t.position,status:"",error:"",title:t.data.title,description:t.data.description})}),this.scope.$apply(this.scope.extScheme.objects=e)},s.prototype.getScheme=function(){return this.serialise(this.scope.intScheme.objects),this.scope.extScheme},s}()}]),angular.module("angular-bpmn").directive("bpmnEditorPalette",["log",function(t){return{restrict:"A",scope:{bpmnEditorPalette:"=",settings:"="},template:'<div class="group" ng-repeat="group in bpmnEditorPalette.groups" data-group="{{::group.name}}"> <div class="entry" ng-repeat="entry in group.items" ng-class="[entry.class]" bpmn-editor-palette-node="entry" entry-type="{{entry.type}}" settings="settings" data-help="{{entry.tooltip}}"></div>',link:function(t,e,n){}}}]),angular.module("angular-bpmn").directive("bpmnEditorPaletteNode",["log","$timeout","$templateCache","$compile","$templateRequest",function(t,e,n,o,i){return{restrict:"A",scope:{bpmnEditorPaletteNode:"=",settings:"=settings"},link:function(t,e,n){var s,r,a,p,l;return s=$(e),r=t.bpmnEditorPaletteNode,p={},l=1,r.shape.helper?p=o('<div class="helper">'+r.shape.helper+"</div>")(t):r.shape.templateUrl&&(a=i(t.settings.theme.root_path+"/"+t.settings.engine.theme+"/"+r.shape.templateUrl),a.then(function(e){return p=o('<div class="helper" ng-class="[bpmnEditorPaletteNode.type.name]">'+e+"</div>")(t)})),s.draggable({grid:t.settings.draggable.grid,helper:function(){return p.css({"-webkit-transform":l,"-moz-transform":"scale("+l+")","-ms-transform":"scale("+l+")","-o-transform":"scale("+l+")",transform:"scale("+l+")"})}}),t.$parent.$parent.$parent.$parent.$watch("zoom",function(t,e){return l=t})}}}]);var bind=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("angular-bpmn").factory("bpmnFullscreen",["log",function(t){var e;return e=function(){function t(t,e,n){this.resize=bind(this.resize,this),this.container=t,this.scope=e,this.callback=n,e.resize=this.resize,this.init()}return t.prototype.container=null,t.prototype.scope=null,t.prototype.available=!1,t.prototype.callback=null,t.prototype.isFull=!1,t.prototype.init=function(){return this.available=document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled},t.prototype.toFull=function(){return this.container[0].requestFullscreen?this.container[0].requestFullscreen():this.container[0].webkitRequestFullscreen?this.container[0].webkitRequestFullscreen():this.container[0].mozRequestFullScreen?this.container[0].mozRequestFullScreen():this.container[0].msRequestFullscreen?this.container[0].msRequestFullscreen():void 0},t.prototype.toMin=function(){return document.cancelFullscreen?document.cancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():void 0},t.prototype.status=function(){return window.innerHeight===this.container.height()},t.prototype.resize=function(){return this.status()?this.toMin():this.toFull()},t}()}]),angular.module("angular-bpmn").service("log",["$log","$rootScope",function(t,e){return{debug:function(){return"debug"===e.runMode?t.debug.apply(self,arguments):void 0},error:function(){return t.error.apply(self,arguments)}}}]),angular.module("angular-bpmn").service("bpmnMock",function(){return{scheme1:{name:"Simply bpmn scheme",description:"",objects:[{id:1,type:{name:"event",start:{0:{0:!0}}},position:{top:80,left:50},status:"",error:"",title:"start event",description:""},{id:2,type:{name:"task",status:"",action:""},position:{top:60,left:260},status:"",error:"",title:"task",description:""},{id:3,type:{name:"event",end:{simply:{top_level:!0}}},position:{top:80,left:530},status:"",error:"",title:"end event",description:""}],connectors:[{id:1,start:{object:1,point:1},end:{object:2,point:10},flow_type:"default",title:"connector №1"},{id:2,start:{object:2,point:4},end:{object:3,point:3},flow_type:"default",title:"connector №2"}]},scheme2:{name:"Parallel Event-Based Gateway",description:"",objects:[{id:1,type:{name:"event",start:{0:{0:!0}}},position:{top:80,left:50},status:"",error:"",title:"message 1",description:""},{id:2,type:{name:"event",start:{0:{0:!0}}},position:{top:240,left:50},status:"",error:"",title:"message 2",description:""},{id:3,type:{name:"gateway",base:"data",status:"xor"},position:{top:160,left:190},status:"",error:"",title:"",description:""},{id:4,type:{name:"task"},position:{top:140,left:370},status:"",error:"",title:"task",description:""}],connectors:[{id:1,start:{object:1,point:1},end:{object:3,point:0},flow_type:"default",title:"connector №1"},{id:2,start:{object:2,point:1},end:{object:3,point:2},flow_type:"default",title:"connector №2"},{id:2,start:{object:3,point:1},end:{object:4,point:10},flow_type:"default",title:"connector №3"}]},scheme3:{name:"Base scheme",description:"",objects:[{id:1,type:{name:"event",start:{simply:{top_level:!0}}},parent:0,position:{top:210,left:120},status:"",error:"",title:"",description:""},{id:2,type:{name:"task"},parent:0,position:{top:190,left:220},status:"",error:"",title:"Оформить заявку",description:""},{id:3,type:{name:"task"},parent:0,position:{top:190,left:370},status:"",error:"",title:"Рассмотреть заявку",description:""},{id:4,type:{name:"gateway"},parent:0,position:{top:210,left:540},status:"",error:"",title:"Одобрена?",description:""},{id:5,type:{name:"task"},parent:0,position:{top:190,left:650},status:"",error:"",title:"Выделить машину",description:""},{id:6,type:{name:"task"},parent:0,position:{top:390,left:510},status:"",error:"",title:"Заявка отклоннена",description:""},{id:7,type:{name:"event",end:{simply:{top_level:!0}}},parent:0,position:{top:550,left:540},status:"",error:"",title:"Заявка отклонена",description:""},{id:8,type:{name:"gateway"},parent:0,position:{top:210,left:810},status:"",error:"",title:"Выделена?",description:""},{id:9,type:{name:"gateway",status:"parallel"},parent:0,position:{top:210,left:930},status:"",error:"",title:"",description:""},{id:10,type:{name:"task"},parent:0,position:{top:100,left:1050},status:"",error:"",title:"Машина выделена",description:""},{id:11,type:{name:"task"},parent:0,position:{top:290,left:1050},status:"",error:"",title:"Выполнить рейс",description:""},{id:12,type:{name:"gateway",status:"parallel"},parent:0,position:{top:210,left:1200},status:"",error:"",title:"",description:""},{id:13,type:{name:"event",end:{simply:{top_level:!0}}},parent:0,position:{top:210,left:1340},status:"",error:"",title:"Заявка выполнена",description:""}],connectors:[{id:1,start:{object:1,point:1},end:{object:2,point:10},flow_type:"default",title:""},{id:2,start:{object:2,point:4},end:{object:3,point:10},flow_type:"default",title:""},{id:3,start:{object:3,point:4},end:{object:4,point:3},flow_type:"default",title:""},{id:4,start:{object:4,point:2},end:{object:6,point:1},flow_type:"default",title:"Нет"},{id:4,start:{object:4,point:1},end:{object:5,point:10},flow_type:"default",title:"Да"},{id:5,start:{object:6,point:7},end:{object:7,point:0},flow_type:"default",title:""},{id:6,start:{object:5,point:4},end:{object:8,point:3},flow_type:"default",title:""},{id:7,start:{object:8,point:0},end:{object:3,point:1},flow_type:"default",title:"Нет"},{id:8,start:{object:8,point:1},end:{object:9,point:3},flow_type:"default",title:"Да"},{id:9,start:{object:9,point:1},end:{object:10,point:10},flow_type:"default",title:""},{id:10,start:{object:9,point:1},end:{object:11,point:10},flow_type:"default",title:""},{id:11,start:{object:10,point:4},end:{object:12,point:0},flow_type:"default",title:""},{id:12,start:{object:11,point:4},end:{object:12,point:2},flow_type:"default",title:""},{id:13,start:{object:12,point:1},end:{object:13,point:3},flow_type:"default",title:""}]},scheme4:{name:"Base scheme with grouping",description:"",objects:[{id:1,type:{name:"event",start:{simply:{top_level:!0}}},position:{top:80,left:50},status:"",error:"",title:"",description:""},{id:2,type:{name:"task"},parent:14,position:{top:40,left:40},status:"",error:"",title:"Оформить заявку",description:""},{id:3,type:{name:"task"},parent:15,position:{top:40,left:40},status:"",error:"",title:"Рассмотреть заявку",description:""},{id:4,type:{name:"gateway"},position:{top:290,left:370},status:"",error:"",title:"Одобрена?",description:""},{id:5,type:{name:"task"},parent:14,position:{top:40,left:200},status:"",error:"",title:"Заявка отклонена",description:""},{id:6,type:{name:"event",end:{simply:{top_level:!0}}},parent:14,position:{top:60,left:380},status:"",error:"",title:"Заявка отклонена",description:""},{id:7,type:{name:"task"},parent:16,position:{top:30,left:30},status:"",error:"",title:"Выделить машину",description:""},{id:8,type:{name:"gateway"},parent:16,position:{top:50,left:210},status:"",error:"",title:"Выделена?",description:""},{id:9,type:{name:"gateway",status:"parallel"},parent:16,position:{top:50,left:340},status:"",error:"",title:"",description:""},{id:10,type:{name:"task"},parent:14,position:{top:40,left:480},status:"",error:"",title:"Машина выделена",description:""},{id:11,type:{name:"gateway",status:"parallel"},position:{top:80,left:780},status:"",error:"",title:"",description:""},{id:12,type:{name:"event",end:{simply:{top_level:!0}}},position:{top:80,left:890},status:"",error:"",title:"Заявка выполнена",description:""},{id:13,type:{name:"task"},parent:16,position:{top:30,left:440},status:"",error:"",title:"Выполнить рейс",description:""},{id:14,type:{name:"group"},position:{top:20,left:140},width:"614px",height:"170px",status:"",error:"",title:"Заказчик",description:"",style:"solid"},{id:15,type:{name:"group"},position:{top:230,left:140},width:"186px",height:"176px",status:"",error:"",title:"Канцелярия",description:"",style:"solid"},{id:16,type:{name:"group"},position:{top:430,left:310},width:"588px",height:"168px",status:"",error:"",title:"Гараж",description:"",style:"solid"}],connectors:[{id:1,start:{object:1,point:1},end:{object:2,point:10},flow_type:"default",title:""},{id:2,start:{object:2,point:7},end:{object:3,point:1},flow_type:"default",title:""},{id:3,start:{object:3,point:4},end:{object:4,point:3},flow_type:"default",title:""},{id:4,start:{object:4,point:0},end:{object:5,point:7},flow_type:"default",title:"нет"},{id:5,start:{object:5,point:4},end:{object:6,point:3},flow_type:"default",title:""},{id:6,start:{object:4,point:2},end:{object:7,point:1},flow_type:"default",title:"да"},{id:7,start:{object:7,point:4},end:{object:8,point:3},flow_type:"default",title:""},{id:7,start:{object:8,point:2},end:{object:3,point:7},flow_type:"default",title:"нет"},{id:8,start:{object:8,point:1},end:{object:9,point:3},flow_type:"default",title:"да"},{id:9,start:{object:9,point:0},end:{object:10,point:7},flow_type:"default",title:""},{id:10,start:{object:10,point:4},end:{object:11,point:3},flow_type:"default",title:""},{id:11,start:{object:11,point:1},end:{object:12,point:3},flow_type:"default",title:""},{id:12,start:{object:13,point:1},end:{object:11,point:2},flow_type:"default",title:""},{id:13,start:{object:9,point:1},end:{object:13,point:10},flow_type:"default",title:""}]},scheme5:{name:"Base scheme with swimlane",description:"",objects:[{id:1,type:{name:"event",start:{simply:{top_level:!0}}},parent:15,position:{top:70,left:120},status:"",error:"",title:"",description:""},{id:2,type:{name:"task"},parent:15,position:{top:50,left:240},status:"",error:"",title:"Оформить заявку",description:""},{id:3,type:{name:"task"},parent:16,position:{top:60,left:240},status:"",error:"",title:"Рассмотреть заявку",description:""},{id:4,type:{name:"gateway"},parent:16,position:{top:80,left:420},status:"",error:"",title:"Одобрена?",description:""},{id:5,type:{name:"task"},parent:15,position:{top:50,left:390},status:"",error:"",title:"Заявка отклонена",description:""},{id:6,type:{name:"event",end:{simply:{top_level:!0}}},parent:15,position:{top:70,left:570},status:"",error:"",title:"Заявка отклонена",description:""},{id:7,type:{name:"task"},parent:17,position:{top:60,left:390},status:"",error:"",title:"Выделить машину",description:""},{id:8,type:{name:"gateway"},parent:17,position:{top:80,left:570},status:"",error:"",title:"Выделена?",description:""},{id:9,type:{name:"gateway",status:"parallel"},parent:17,position:{top:80,left:690},status:"",error:"",title:"",description:""},{id:10,type:{name:"task"},parent:15,position:{top:50,left:660},status:"",error:"",title:"Машина выделена",description:""},{id:11,type:{name:"gateway",status:"parallel"},parent:15,position:{top:70,left:830},status:"",error:"",title:"",description:""},{id:12,type:{name:"event",end:{simply:{top_level:!0}}},parent:15,position:{top:70,left:940},status:"",error:"",title:"Заявка выполнена",description:""},{id:13,type:{name:"task"},parent:17,position:{top:60,left:800},status:"",error:"",title:"Выполнить рейс",description:""},{id:14,type:{name:"swimlane"},position:{top:10,left:10},width:"1040px",height:"",status:"",error:"",title:"",description:"",style:""},{id:15,type:{name:"swimlane-row"},parent:14,position:{top:0,left:0},width:"100%",height:"200px",status:"",error:"",title:"Заказчик",description:"",style:""},{id:16,type:{name:"swimlane-row"},parent:14,position:{top:0,left:0},width:"100%",height:"200px",status:"",error:"",title:"Канцелярия",description:"",style:""},{id:17,type:{name:"swimlane-row"},parent:14,position:{top:0,left:0},width:"100%",height:"200px",status:"",error:"",title:"Гараж",description:"",style:""}],connectors:[{id:1,start:{object:1,point:1},end:{object:2,point:10},flow_type:"default",title:""},{id:2,start:{object:2,point:7},end:{object:3,point:1},flow_type:"default",title:""},{id:3,start:{object:3,point:4},end:{object:4,point:3},flow_type:"default",title:""},{id:4,start:{object:4,point:0},end:{object:5,point:7},flow_type:"default",title:"нет"},{id:5,start:{object:5,point:4},end:{object:6,point:3},flow_type:"default",title:""},{id:6,start:{object:4,point:2},end:{object:7,point:1},flow_type:"default",title:"да"},{id:7,start:{object:7,point:4},end:{object:8,point:3},flow_type:"default",title:""},{id:7,start:{object:8,point:2},end:{object:3,point:7},flow_type:"default",title:"нет"},{id:8,start:{object:8,point:1},end:{object:9,point:3},flow_type:"default",title:"да"},{id:9,start:{object:9,point:0},end:{object:10,point:7},flow_type:"default",title:""},{id:10,start:{object:10,point:4},end:{object:11,point:3},flow_type:"default",title:""},{id:11,start:{object:11,point:1},end:{object:12,point:3},flow_type:"default",title:""},{id:12,start:{object:13,point:1},end:{object:11,point:2},flow_type:"default",title:""},{id:13,start:{object:9,point:1},end:{object:13,point:10},flow_type:"default",title:""}]}}}),angular.module("angular-bpmn").directive("bpmnObject",["log","$timeout","$templateCache","$compile","$templateRequest","$q",function(t,e,n,o,i,s){return{restrict:"A",controller:["$scope","$element",function(t,e){var n,o,i;switch(o=$(e),n=[],t.data.type.name){case"poster":o.find("img").on("dragstart",function(t){return t.preventDefault()});break;case"group":if((null==t.data.resizable||!t.data.resizable)&&"editor"!==t.object.settings.engine.status)break;o.resizable({minHeight:100,minWidth:100,grid:10,handles:"all",start:function(e,o){return n=t.object.getAllChilds()},stop:function(e,n){return t.instance.repaintEverything()},resize:function(e,i){return angular.forEach(n,function(t,e){var n,i;return n=t.position.left+t.size.width,i=t.position.top+t.size.height,o.width()<=n+20&&o.css("width",n+20),o.height()<=i+20?o.css("height",i+20):void 0}),t.instance.repaintEverything()}});break;case"swimlane":if((null==t.data.resizable||!t.data.resizable)&&"editor"!==t.object.settings.engine.status)break;o.resizable({minHeight:200,minWidth:400,grid:10,handles:"e",start:function(){return n=t.object.getAllChilds(),t.instance.repaintEverything()},resize:function(){return angular.forEach(n,function(t){var e;if("swimlane-row"!==t.data.type)return e=t.position.left+t.size.width,o.width()<=e+20?o.css("width",e+20):void 0}),t.instance.repaintEverything()}});break;case"swimlane-row":if((null==t.data.resizable||!t.data.resizable)&&"editor"!==t.object.settings.engine.status)break;o.resizable({minHeight:200,minWidth:400,grid:10,handles:"s",start:function(){return n=t.object.getAllChilds(),t.instance.repaintEverything()},resize:function(){return angular.forEach(n,function(t){var e;return e=t.position.top+t.size.height,o.height()<=e+20?o.css("height",e+20):void 0}),t.instance.repaintEverything()}})}return i=function(){var e;return e={top:t.data.position.top,left:t.data.position.left},o.css(e),t.instance.repaintEverything()},t.$watch("data.position",function(t,e){return t!==e?i():void 0}),i()}],link:function(t,e,n){}}}]),angular.module("angular-bpmn").factory("bpmnObjectFact",["bpmnSettings","$compile","$rootScope","log","$templateRequest","$templateCache",function(t,e,n,o,i,s){var r;return r=function(){function r(e,n){var i;o.debug("object construct"),this.parentScope=n,this.settings=n.settings,this.data=e,i=t.template(e.type.name),this.anchor=i.anchor,this.size=i.size,this.make=i.make,this.canAParent=i.canAParent||null,this.draggable=i.draggable,this.templateUrl=i.templateUrl||null,this.template=i.template||null,this.childs=[],this.position={top:e.position.top,left:e.position.left},this.templateUpdate()}return r.prototype.id=null,r.prototype.isDebug=!0,r.prototype.parentScope=null,r.prototype.data=null,r.prototype.anchor=null,r.prototype.make=null,r.prototype.draggable=null,r.prototype.templateUrl=null,r.prototype.template=null,r.prototype.element=null,r.prototype.container=null,r.prototype.size=null,r.prototype.points=null,r.prototype.settings=null,r.prototype.childs=null,r.prototype.position={top:0,left:0},r.prototype.isParent=!1,r.prototype.canAParent=null,r.prototype.templateUpdate=function(){var t,r,a,p;return r=n.$new(),r.data=this.data,r.instance=this.parentScope.instance,r.object=this,t=function(t){return function(e){return t.element.empty().append(e)}}(this),null!=this.templateUrl&&""!==this.templateUrl?(null==this.element&&(this.element=e('<div bpmn-object class="'+this.data.type.name+' draggable etc" ng-class="[data.status]"></div>')(r)),p=this.settings.theme.root_path+"/"+this.settings.engine.theme+"/"+this.templateUrl,a=s.get(p),null==a?(o.debug("template not found",p),this.elementPromise=i(p),this.elementPromise.then(function(n){return t(e(n)(r)),s.put(p,n)})):t(e(a)(r))):null==this.element?this.element=e(this.template)(r):void 0},r.prototype.generateAnchor=function(t){var e;if(this.anchor&&0!==this.anchor.length)return this.element?(e=[],angular.forEach(this.anchor,function(n){return function(o){var i;return i=n.parentScope.instance.addEndpoint(n.element,{anchor:o,maxConnections:-1},t),-1===e.indexOf(i)?e.push(i):void 0}}(this)),this.points=e):void o.debug("generateAnchor: @element is null",this)},r.prototype.appendTo=function(t,e){return this.element&&""!==this.element?(this.container=t,t.append(this.element),this.size?$(this.element).css({width:this.size.width,height:this.size.height}):o.error("@size is null, element:",this.element),this.parentScope.instance.off(this.element),this.parentScope.instance.on(this.element,"click",function(t){return function(e){var n;return n=!1,key.getPressedKeyCodes().indexOf(16)>-1&&(n=!0),n||(t.parentScope.selected=[]),t.parentScope.$apply(t.parentScope.selected.push(t.data.id)),n||angular.forEach(t.parentScope.intScheme.objects,function(t){return t.select(!1)}),t.select(!0),e.stopPropagation()}}(this)),this.checkParent(),this.generateAnchor(e),this.setDraggable(this.draggable)):void o.debug("appendTo: @element is null",this)},r.prototype.select=function(t){return t?$(this.element).addClass("selected"):$(this.element).removeClass("selected")},r.prototype.elementOffset=function(){var t,e,n;return e=$(this.element).offset(),n=this.size.width,t=this.size.height,"auto"!==this.size.width&&n||(n=$(this.element).width()),"auto"!==this.size.height&&t||(t=$(this.element).height()),{top:e.top,left:e.left,right:e.left+n,bottom:e.top+t}},r.prototype.getId=function(){return null==this.id&&(this.id=$(this.element).attr("id")),this.id},r.prototype.setDraggable=function(t){return this.parentScope.instance.setDraggable($(this.element),t)},r.prototype.group=function(t){return this.parentScope.instance.addToPosse(this.getId(),{id:t,active:!0})},r.prototype.ungroup=function(t){return this.parentScope.instance.removeFromPosse(this.getId(),t)},r.prototype.checkParent=function(){var t,e;return null==this.data.parent||""===this.data.parent?void((null!=this.data.draggable&&this.data.draggable||"editor"===this.settings.engine.status)&&this.parentScope.instance.draggable(this.element,$.extend(!0,this.settings.draggable,{drag:function(t){return function(){return t.childs.length?t.parentScope.instance.repaintEverything():void 0}}(this),stop:function(t){return function(e){return t.position.left=e.pos[0],t.position.top=e.pos[1]}}(this)}))):(t=null,angular.forEach(this.parentScope.intScheme.objects,function(e){return function(n){return n.data.id===e.data.parent?t=n:void 0}}(this)),null!=t?(this.element.removeClass("etc"),e=this.setParent(t),null!=this.data.draggable&&this.data.draggable||"editor"===this.settings.engine.status?this.parentScope.instance.draggable(this.element,$.extend(!0,this.settings.draggable,{containment:e,stop:function(t){return function(e){return t.position.left=e.pos[0],t.position.top=e.pos[1],t.parentScope.instance.repaintEverything()}}(this)})):void 0):void 0)},r.prototype.setParent=function(t){var e,n;if(null!=t)return n=t.element,this.parentScope.instance.setParent(this.element,n),e=n.attr("id"),t.isParent=!0,-1===$.inArray(this.data,t.childs)&&t.childs.push(this),n.hasClass(e)?e:(n.addClass(e).removeClass("etc"),null!=this.data.draggable&&this.data.draggable||"editor"===this.settings.engine.status?this.parentScope.instance.draggable(n,$.extend(!0,this.settings.draggable,{drag:function(t){return function(e,n){return t.parentScope.instance.repaintEverything()}}(this),stop:function(t){return function(e){return t.position.left=e.pos[0],t.position.top=e.pos[1],t.parentScope.instance.repaintEverything()}}(this)})):void 0)},r.prototype.removeParent=function(){},r.prototype.getAllChilds=function(){var t;return t=[],angular.forEach(this.childs,function(e){var n;return t.push(e),n=e.getAllChilds(),n.length>0?t=t.concat(n):void 0}),t},r.prototype.remove=function(){var t;return t=this.getId(),null!=t?(o.debug("remove: ",t),this.parentScope.instance.detachAllConnections(this.element).empty(t).remove(t),this.childs=null,this.isParent=!1,this.container=null,this.element=null,this.points=null):void 0},r}()}]),angular.module("angular-bpmn").factory("bpmnPanning",["log","$compile","$timeout",function(t,e,n){var o;return o=function(){function t(t,e,n){this.container=t,this.scope=e,this.wrapper=n,this.init()}return t.prototype.container=null,t.prototype.scope=null,t.prototype.wrapper=null,t.prototype.init=function(){var t,o,i;return i=e('<div class="panning-cross"> <svg> <g id="layer1" transform="translate(-291.18256,-337.29837)"> <path stroke-linejoin="miter" d="m331.14063,340.36763,0,29.99702" stroke="#7B7B7B" stroke-linecap="butt" stroke-miterlimit="4" stroke-dasharray="none" stroke-width="2"/> <path stroke-linejoin="miter" d="m316.11461,355.29379,30.24144,0" stroke="#7B7B7B" stroke-linecap="butt" stroke-miterlimit="4" stroke-dasharray="none" stroke-width="2"/> </g> </svg> </div>')(this.scope),this.container.append(i),$(i).css({position:"absolute",top:-23,left:-45}),this.wrapper.append(e('<div class="zoom-info" data-help="zoom">x{{zoom}}</div>')(this.scope)),o={x:0,y:0,state:!1},t={x:0,y:0},this.wrapper.on("mousedown",function(t){return function(e){return t.scope.settings.engine.container.movable&&!($(e.target).hasClass("ui-resizable-handle")||$(e.target).hasClass("entry")||$(e.target).hasClass("viewport")||$(e.target).hasClass("minimap"))?o.state||e.which!==LEFT_MB?void 0:(o.x=e.pageX,o.y=e.pageY,o.state=!0):void 0}}(this)),this.wrapper.on("mousemove",function(e){return function(n){var i;return o.state?(t.x=n.pageX-o.x,t.y=n.pageY-o.y,i=e.container.offset(),e.container.offset({left:i.left+t.x,top:i.top+t.y}),o.x=n.pageX,o.y=n.pageY):void 0}}(this)),this.wrapper.on("mouseup",function(t){return function(e){return t.scope.settings.engine.container.movable&&o.state?o.state=!1:void 0}}(this)),this.wrapper.on("contextmenu",function(t){return!1}),this.wrapper.on("mouseleave",function(t){return o.state?o.state=!1:void 0}),this.wrapper.on("mousewheel",function(t){return function(e){return t.scope.settings.engine.container.zoom?(e.preventDefault(),t.scope.zoom+=.1*e.deltaY,t.scope.zoom=parseFloat(t.scope.zoom.toFixed(1)),t.scope.zoom<.1?t.scope.zoom=.1:t.scope.zoom>2&&(t.scope.zoom=2),t.scope.instance.setZoom(t.scope.zoom),t.scope.instance.repaintEverything(t.scope.zoom),n(function(){return t.scope.$apply(t.scope.zoom)},0),t.container.css({"-webkit-transform":t.scope.zoom,"-moz-transform":"scale("+t.scope.zoom+")","-ms-transform":"scale("+t.scope.zoom+")","-o-transform":"scale("+t.scope.zoom+")",transform:"scale("+t.scope.zoom+")"})):void 0}}(this))},t.prototype.destroy=function(){return this.wrapper.off("mousedown"),this.wrapper.off("mousemove"),this.wrapper.off("mouseup"),this.wrapper.off("contextmenu"),this.wrapper.off("mousewheel"),this.container=null,this.scope=null,this.wrapper=null},t}()}]);var LEFT_MB,MIDDLE_MB,RIGHT_MB,bind=function(t,e){return function(){return t.apply(e,arguments)}},extend=function(t,e){function n(){this.constructor=t}for(var o in e)hasProp.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;LEFT_MB=1,MIDDLE_MB=2,RIGHT_MB=3,angular.module("angular-bpmn").factory("bpmnScheme",["$rootScope","log","bpmnUuid","$compile","bpmnSettings","$templateCache","$templateRequest","$q","$timeout","bpmnObjectFact","bpmnPanning","bpmnFullscreen","bpmnEditor",function(t,e,n,o,i,s,r,a,p,l,c,u,d){var h;return h=function(p){function d(e,i){this.changeTheme=bind(this.changeTheme,this);var s;d.__super__.constructor.apply(this,arguments),this.id=n.gen(),this.container=e,s=e.parent("."+this.wrap_class),0===s.length&&e.wrap('<div class="'+this.wrap_class+'"></div>'),this.wrapper=e.parent("."+this.wrap_class).attr("id",this.id),preventSelection(document),this.scope=t.$new(),this.scope.extScheme={},this.scope.intScheme={objects:{},connectors:[]},this.scope.settings={},this.scope.selected=[],this.scope.zoom=1,this.setSettings(i),this.scope.changeTheme=this.changeTheme,this.wrapper.append('<div class="page-loader"><div class="spinner">loading...</div></div>'),this.wrapper.append(o('<div ng-if="settings.engine.container.theme_selector" class="theme-selector entry"> <select class="form-control" ng-model="settings.engine.theme" ng-change="changeTheme()" style="width: auto;" data-help="select theme"> <option ng-repeat="them in settings.theme.list" value="{{them}}">{{them}}</option></select> </div>')(this.scope)),this.fullscreen=new u(this.wrapper,this.scope),this.fullscreen.available&&this.wrapper.append(o('<div ng-if="settings.engine.container.fullscreen" class="fullscreen entry" ng-click="resize()" data-help="resize editor window">full screen</div>')(this.scope))}return extend(d,p),d.prototype.isDebug=!0,d.prototype.isStarted=!1,d.prototype.id=null,d.prototype.scope=null,d.prototype.container=null,d.prototype.wrapper=null,d.prototype.cache=null,d.prototype.style_id="bpmn-style-theme",d.prototype.wrap_class="bpmn-wrapper",d.prototype.schemeWatch=null,d.prototype.stopListen=null,
d.prototype.panning=null,d.prototype.fullscreen=null,d.prototype.setStatus=function(){return"editor"===this.scope.settings.engine.status?(this.initEditor(),this.container.addClass("editor")):this.container.addClass("viewer")},d.prototype.setScheme=function(t){return null==t&&(t=this.scope.extScheme||{}),this.scope.extScheme=t},d.prototype.setSettings=function(t){return null==t&&(t={}),this.scope.settings=$.extend(!0,angular.copy(i),angular.copy(t)),"editor"===this.scope.settings.engine.status&&(this.scope.settings=$.extend(!0,this.scope.settings,{point:{isSource:!0,isTarget:!0,endpoint:["Rectangle",{width:15,height:15}],paintStyle:{outlineWidth:1},maxConnections:-1}})),this.loadStyle(),this.cacheTemplates(),this.objectsUpdate()},d.prototype.loadStyle=function(){var t,n,o;return o=this.scope.settings.engine.theme,t=this.scope.settings.theme.root_path+"/"+o+"/style.css",n=$("link#"+this.style_id+"-"+o),0===n.length?$("<link/>",{rel:"stylesheet",href:t,id:this.style_id+"-"+o}).appendTo("head"):n.attr("href",t),e.debug("load style file:",t),this.wrapper.removeClass(),this.wrapper.addClass(this.wrap_class+" "+o)},d.prototype.cacheTemplates=function(){return this.cache||(this.cache=[]),angular.forEach(this.scope.settings.templates,function(t){return function(n){var o,i,a;if(null!=n.templateUrl&&""!==n.templateUrl)return a=t.scope.settings.theme.root_path+"/"+t.scope.settings.engine.theme+"/"+n.templateUrl,o=s.get(a),null==o?(i=r(a),t.cache.push(i),i.then(function(t){return e.debug("load template file:",a),s.put(a,t)})):void 0}}(this))},d.prototype.makePackageObjects=function(t){var e;return e=[],angular.forEach(this.scope.extScheme.objects,function(t){return function(n){var o;return o=new l(n,t.scope),t.scope.intScheme.objects[n.id]=o,e.push(o.elementPromise)}}(this)),a.all(e).then(function(e){return function(){return angular.forEach(e.scope.intScheme.objects,function(t){return t.appendTo(e.container,e.scope.settings.point)}),e.connectPackageObjects(),e.scope.instance.repaintEverything(),e.isStarted=!0,e.wrapper.find(".page-loader").fadeOut("slow"),t()}}(this))},d.prototype.connectPackageObjects=function(){var t;if(null!=(null!=(t=this.scope.extScheme)?t.connectors:void 0))return e.debug("connect package objects"),angular.forEach(this.scope.extScheme.connectors,function(t){return function(n){var o,i,s;if(n.start&&n.end&&t.scope.intScheme.objects[n.start.object]&&t.scope.intScheme.objects[n.end.object]&&t.scope.intScheme.objects[n.start.object].points&&t.scope.intScheme.objects[n.end.object].points)return i={},s={},angular.forEach(t.scope.intScheme.objects,function(t){return t.data.id===n.start.object&&(i=t.points),t.data.id===n.end.object?s=t.points:void 0}),null==i[n.start.point]?void e.error("connect: source not found",t):null==s[n.end.point]?void e.error("connect: target not found",t):(o={sourceEndpoint:i[n.start.point],targetEndpoint:s[n.end.point]},n.title&&""!==n.title&&(o.overlays=[["Label",{label:n.title,cssClass:"aLabel"},{id:"myLabel"}]]),t.scope.intScheme.connectors.push(t.scope.instance.connect(o,t.scope.settings.connector)))}}(this))},d.prototype.deselectAll=function(){return angular.forEach(this.scope.intScheme.objects,function(t){return t.select(!1)})},d.prototype.objectsUpdate=function(){return angular.forEach(this.scope.intScheme.objects,function(t){return t.templateUpdate()})},d.prototype.start=function(){return e.debug("start"),a(function(t){return function(e){return t.instart(e)}}(this))},d.prototype.instart=function(t){var n;return this.panning||(this.panning=new c(this.container,this.scope,this.wrapper)),this.loadStyle(),this.scope.instance||(this.scope.instance=jsPlumb.getInstance($.extend(!0,this.scope.settings.instance,{Container:this.container}))),this.cache=[],this.cacheTemplates(),this.container.addClass("bpmn"),this.setStatus(),a.all(this.cache).then(function(e){return function(){return e.makePackageObjects(t)}}(this)),null!=(null!=(n=this.scope.settings.engine.container)?n.resizable:void 0)&&(this.wrapper.resizable("instance")&&this.wrapper.resizable("destroy"),this.wrapper.resizable({minHeight:200,minWidth:400,grid:this.scope.settings.draggable.grid,handles:"s"})),this.scope.instance.bind("click",function(t){return function(e){return t.scope.instance.select().each(function(t){return t.removeClass("selected")}),e.addClass("selected"),t.scope.selected.push({object:e,type:"connector"})}}(this)),this.scope.instance.bind("beforeDrop",function(t){return function(t){return t.sourceId!==t.targetId}}(this)),this.stopListen=this.scope.$on("$routeChangeSuccess",function(t){return function(){return t.destroy()}}(this)),this.wrapper.on("mousedown",function(t){return function(t){return e.debug("@mousedown")}}(this))},d.prototype.destroy=function(){return e.debug("destroy"),this.wrapper.find(".page-loader").fadeIn("fast"),angular.forEach(this.scope.intScheme.objects,function(t){return t.remove()}),this.scope.intScheme.objects=[],this.scope.instance.empty(this.container),this.schemeWatch&&this.schemeWatch(),this.panning&&this.panning.destroy(),this.panning=null,this.wrapper.off("mousedown")},d.prototype.restart=function(){return e.debug("restart"),null!=this.isStarted&&this.destroy(),this.start()},d.prototype.changeTheme=function(){return this.loadStyle(),this.cacheTemplates(),this.objectsUpdate()},d}(d)}]),angular.module("angular-bpmn").factory("bpmnSettings",function(){var t,e,n,o,i,s,r,a,p,l,c,u,d,h,m;return m={root_path:"/themes",list:["orange","minimal"]},r={theme:"minimal",status:"viewer",container:{resizable:!0,zoom:!1,movable:!0,minimap:!1,theme_selector:!0,fullscreen:!0}},e=["Flowchart",{cornerRadius:0,midpoint:.5,minStubLength:10,stub:[30,30],gap:0}],a={DragOptions:{cursor:"pointer",zIndex:20},ConnectionOverlays:[["Arrow",{location:1,id:"arrow",width:12,length:12,foldback:.8}]],Container:"container",Connector:e},i={filter:".ui-resizable-handle",grid:[5,5],drag:function(t,e){}},o={strokeStyle:"#000000",lineWidth:2,outlineWidth:4},l={isSource:!0,isTarget:!0,endpoint:["Dot",{radius:1}],maxConnections:-1,paintStyle:{outlineWidth:1},hoverPaintStyle:{},connectorStyle:o},n={connector:e,isSource:!0,isTarget:!0},c={filter:".ep",anchor:[],connector:e,connectorStyle:o,endpoint:["Dot",{radius:1}],maxConnections:-1,onMaxConnections:function(t,e){return alert("Maximum connections ("+t.maxConnections+") reached")}},u={anchor:[],endpoint:["Dot",{radius:1}],allowLoopback:!1,uniqueEndpoint:!0,isTarget:!0,maxConnections:-1},h={event:{templateUrl:"event.svg",anchor:[[.52,.05,0,-1,0,2],[1,.52,1,0,-2,0],[.52,1,0,1,0,-2],[.1,.52,-1,0,2,0]],make:["source","target"],draggable:!0,size:{width:50,height:50}},task:{templateUrl:"task.svg",anchor:[[.25,.04,0,-1,0,2],[.5,.04,0,-1,0,2],[.75,.04,0,-1,0,2],[.97,.25,1,0,-2,0],[.97,.5,1,0,-2,0],[.97,.75,1,0,-2,0],[.75,.97,0,1,0,-2],[.5,.97,0,1,0,-2],[.25,.97,0,1,0,-2],[.04,.75,-1,0,2,0],[.04,.5,-1,0,2,0],[.04,.25,-1,0,2,0]],make:["source","target"],draggable:!0,size:{width:112,height:92}},gateway:{templateUrl:"gateway.svg",anchor:[[.5,0,0,-1,0,2],[1,.5,1,0,-2,0],[.5,1,0,1,0,-2],[0,.5,-1,0,2,0]],make:["source","target"],draggable:!0,size:{width:52,height:52}},group:{template:'<div bpmn-object class="group solid etc draggable" ng-style="{width: data.width, height: data.height}" ng-class="{ dashed : data.style == \'dashed\', solid : data.style == \'solid\' }"> <div class="title">{{data.title}}</div> </div>',anchor:[],make:[],draggable:!0,size:{width:"auto",height:"auto"},helper:'<div class="bpmn-icon-subprocess-expanded" style="font-size: 33px"></div>',canAParent:!0},swimlane:{template:'<div bpmn-object class="swimlane etc draggable" ng-style="{ width: data.width }"></div>',anchor:[],make:[],draggable:!0,size:{width:"auto",height:"auto"},helper:'<div class="bpmn-icon-participant" style="font-size: 33px"></div>'},"swimlane-row":{template:'<div bpmn-object class="swimlane-row" ng-style="{width: \'100%\', height: data.height }"> <div class="header"><div class="text">{{data.title}}</div></div> </div>',anchor:[],make:[],draggable:!1,size:{width:"auto",height:"auto"},canAParent:!0},poster:{template:'<div bpmn-object class="poster draggable" ng-class="{ \'etc\' : data.draggable }"><img ng-src="{{data.url}}"></div>',anchor:[],make:[],draggable:!0,size:{width:"auto",height:"auto"}},"default":{template:'<div bpmn-object class="dummy etc draggable">shape not found</div>',anchor:[[.5,0,0,-1,0,2],[1,.5,1,0,-2,0],[.5,1,0,1,0,-2],[0,.5,-1,0,2,0]],make:["source","target"],draggable:!0,size:{width:50,height:50}}},t={id:0,type:{name:""},position:{top:0,left:0},status:"",error:"",title:"",description:""},d=function(t){return null!=h[t]?h[t]:h["default"]},s={groups:[{name:"event",items:[{type:{name:"event",start:{0:{0:!0}}},title:"start","class":"bpmn-icon-start-event-none",tooltip:"Create start event",shape:d("event")},{type:{name:"event",intermediate:{0:{0:!0}}},title:"intermediate","class":"bpmn-icon-intermediate-event-none",tooltip:"Create intermediate event",shape:d("event")},{type:{name:"event",end:{simply:{top_level:!0}}},title:"end","class":"bpmn-icon-end-event-none",tooltip:"Create end event",shape:d("event")}]},{name:"gateway",items:[{type:{name:"gateway",start:{0:{0:!0}}},title:"gateway","class":"bpmn-icon-gateway-xor",tooltip:"Create gateway",shape:d("gateway")}]},{name:"task",items:[{type:{name:"task"},title:"task","class":"bpmn-icon-task-none",tooltip:"Create task",shape:d("task")}]},{name:"group",items:[{type:{name:"group"},title:"group","class":"bpmn-icon-subprocess-expanded",tooltip:"Create group",shape:d("group")}]},{name:"swimlane",items:[{type:{name:"swimlane"},title:"swimlane","class":"bpmn-icon-participant",tooltip:"Create swimlane",shape:d("swimlane")}]}]},p={"delete":{name:"delete",callback:"removeObject"}},{theme:m,engine:r,instance:a,draggable:i,point:l,connector:n,source:c,target:u,template:d,templates:h,baseObject:t,editorPallet:s,keyboard:p}}),function(){window.lsTooltip={timeout:0,init:function(){$(document).on("mouseover","[data-help]",function(){var t;t=this,lsTooltip.timeout=setTimeout(function(){lsTooltip.open(t)},400)}),$(document).on("mouseout","[data-help]",function(){clearTimeout(lsTooltip.timeout),lsTooltip.close()})},destroy:function(){$(document).off("mouseover","[data-help]"),$(document).off("mouseout","[data-help]")},open:function(t){var e,n,o,i,s,r,a;$("body").prepend($("<div>",{"class":"ls-tooltip"}).append($("<div>",{"class":"inner"})).append($("<span>"))),r=$(".ls-tooltip"),r.find(".inner").html($(t).data("help")),a=$(window).width(),o=$(t).width(),e=$(t).offset().left,n=$(t).offset().top,s=r.outerWidth(),i=r.outerHeight(),r.css({top:n-i-10,left:e-(s-o)/2}),r.offset().left+s>a&&(r.css({left:"auto",right:10}),r.find("span").css({left:"auto",right:a-$(t).offset().left-$(t).outerWidth()/2-17,marginLeft:"auto"}))},close:function(){$(".ls-tooltip").remove()}},$(document).ready(function(){window.lsTooltip.init()})}(),angular.module("angular-bpmn").factory("bpmnUuid",function(){var t;return t=function(){function t(){}return t.generator=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e,n,o;return e=(new Date).getTime(),o=(e+16*Math.random())%16|0,e=Math.floor(e/16),n=null,n="x"===t?o:3&o|8,n.toString(16)})},t.gen=function(){return this.generator()},t}()});